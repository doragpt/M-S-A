<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>店舗管理</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-4">
    <h1>店舗URL管理</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="閉じる"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <ul class="nav nav-tabs mb-3" id="entryTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single-entry" type="button" role="tab" aria-controls="single-entry" aria-selected="true">個別追加</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="bulk-tab" data-bs-toggle="tab" data-bs-target="#bulk-entry" type="button" role="tab" aria-controls="bulk-entry" aria-selected="false">一括追加</button>
      </li>
    </ul>
    
    <div class="tab-content" id="entryTabsContent">
      <div class="tab-pane fade show active" id="single-entry" role="tabpanel" aria-labelledby="single-tab">
        <form method="post" action="{{ url_for('manage_store_urls') }}">
          <div class="mb-3">
            <label for="store_url" class="form-label">店舗URL</label>
            <input type="text" class="form-control" id="store_url" name="store_url" required>
          </div>
          <button type="submit" class="btn btn-primary">追加</button>
        </form>
      </div>
      
      <div class="tab-pane fade" id="bulk-entry" role="tabpanel" aria-labelledby="bulk-tab">
        <form method="post" action="{{ url_for('bulk_add_store_urls') }}">
          <div class="mb-3">
            <label for="bulk_urls" class="form-label">複数のURL (1行に1つのURLを入力)</label>
            <textarea class="form-control" id="bulk_urls" name="bulk_urls" rows="10" required></textarea>
            <div class="form-text">各URLは改行で区切ってください。</div>
          </div>
          <button type="submit" class="btn btn-primary">一括追加</button>
        </form>
      </div>
    </div>
    <hr>
    <h2>登録済み店舗URL</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>店舗URL</th>
          <th>状態</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for url in urls %}
        <tr {% if url.error_flag %} class="table-danger" {% endif %}>
          <td>{{ url.id }}</td>
          <td>{{ url.store_url }}</td>
          <td>{{ "エラー" if url.error_flag else "正常" }}</td>
          <td>
            <!-- 編集リンクを追加 -->
            <a href="{{ url_for('edit_store_url', id=url.id) }}" class="btn btn-sm btn-primary">編集</a>
            <!-- 削除ボタン -->
            <form method="post" action="{{ url_for('delete_store_url', id=url.id) }}" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('本当に削除しますか？');">削除</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
