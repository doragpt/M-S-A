<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>店舗管理</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-4">
    <h1>店舗URL管理</h1>
    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i> 赤色でハイライトされている店舗URLは、最新のスクレイピングで取得に失敗した店舗です。
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="閉じる"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="single-tab" data-bs-toggle="tab" data-bs-target="#single" type="button" role="tab" aria-controls="single" aria-selected="true">個別登録</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="bulk-tab" data-bs-toggle="tab" data-bs-target="#bulk" type="button" role="tab" aria-controls="bulk" aria-selected="false">一括登録</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="single" role="tabpanel" aria-labelledby="single-tab">
        <form method="post" action="{{ url_for('manage_store_urls') }}">
          <div class="mb-3">
            <label for="store_url" class="form-label">店舗URL</label>
            <input type="text" class="form-control" id="store_url" name="store_url" required>
          </div>
          <button type="submit" class="btn btn-primary">追加</button>
        </form>
      </div>
      <div class="tab-pane fade" id="bulk" role="tabpanel" aria-labelledby="bulk-tab">
        <form method="post" action="{{ url_for('bulk_add_urls') }}">
          <div class="mb-3">
            <label for="bulk_urls" class="form-label">URLを1行に1つずつ入力</label>
            <textarea class="form-control" id="bulk_urls" name="bulk_urls" rows="10" required placeholder="https://www.example.com/store1/&#10;https://www.example.com/store2/&#10;https://www.example.com/store3/"></textarea>
          </div>
          <div class="mb-3">
            <label for="skip_duplicates" class="form-check-label">
              <input type="checkbox" class="form-check-input" id="skip_duplicates" name="skip_duplicates" value="1" checked>
              重複をスキップする
            </label>
          </div>
          <button type="submit" class="btn btn-primary">一括登録</button>
        </form>
      </div>
    </div>
    <hr>
    <h2>登録済み店舗URL</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>店舗URL</th>
          <th>状態</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for url in urls %}
        <tr {% if url.error_flag > 0 %}class="bg-danger text-white"{% endif %}>
          <td>{{ url.id }}</td>
          <td>{{ url.store_url }}</td>
          <td>{{ "エラー" if url.error_flag else "正常" }}</td>
          <td>
            <!-- 編集リンクを追加 -->
            <a href="{{ url_for('edit_store_url', id=url.id) }}" class="btn btn-sm btn-primary">編集</a>
            <!-- 削除ボタン -->
            <form method="post" action="{{ url_for('delete_store_url', id=url.id) }}" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('本当に削除しますか？');">削除</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>