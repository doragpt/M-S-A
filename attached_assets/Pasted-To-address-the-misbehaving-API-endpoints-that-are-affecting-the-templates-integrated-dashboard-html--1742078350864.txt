To address the misbehaving API endpoints that are affecting the templates/integrated_dashboard.html, we should ensure that the endpoints return data in the expected format. The following errors were identified from the console logs in integrated_dashboard.html:

Hourly Analysis Error: Related to /api/hourly-analysis.
Area Statistics Error: Related to /api/area-stats.
Genre Ranking Error: Related to /api/ranking/genre.
Popular Ranking Error: Related to /api/ranking/popular.
These endpoints should return consistent JSON responses with a status key and a data key. Let's make sure each endpoint adheres to this standard by using the api_response helper function.

Proposed Changes
We will update these endpoints in api_endpoints.py to ensure consistent response formats:

Update /api/hourly-analysis endpoint.
Update /api/area-stats endpoint.
Update /api/ranking/genre endpoint.
Update /api/ranking/popular endpoint.
Let's proceed with updating these endpoints in the file.

# Ensure consistent response format for the get_hourly_analysis function
@cached(1800)
def get_hourly_analysis():
    ...
    # Return the response with api_response helper to ensure format consistency
    return api_response({
        'store': store or '全店舗',
        'days_analyzed': days,
        'hourly_data': hourly_data,
        'peak_hour': peak_hour,
        'min_hour': min_hour
    })
# Ensure consistent response format for the get_area_stats function
@cached(1800)
def get_area_stats():
    ...
    # Return the response with api_response helper to ensure format consistency
    return api_response({
        'area_count': len(area_data),
        'areas': area_data
    })
# Ensure consistent response format for the get_genre_ranking function
@cached(1800)
def get_genre_ranking():
    ...
    # Return the response with api_response helper to ensure format consistency
    return api_response({
        'biz_type': biz_type,
        'genre_count': len(genre_data),
        'genres': genre_data
    })
# Ensure consistent response format for the get_popular_ranking function
@cached(1800)
def get_popular_ranking():
    ...
    # Return the response with api_response helper to ensure format consistency
    return api_response({
        'period': period,
        'start_date': start_date.isoformat(),
        'end_date': now.isoformat(),
        'limit': limit,
        'store_count': len(store_data),
        'stores': store_data
    })
These modifications ensure that each endpoint returns a consistent JSON format using the api_response helper.

If you would like me to apply these changes to api_endpoints.py, let me know!